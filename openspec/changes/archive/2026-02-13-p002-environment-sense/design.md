## Context

管理端需要在 FnOS 环境中验证宿主机路径与 Nginx 配置的可访问性，当前缺少对不可达与权限不足的精确区分，也缺少可读的健康报告输出。探测过程可能受到 10.8.8.80 宿主机负载影响，需要避免阻塞 API 请求。安全约束要求禁止硬编码 root 密码，优先使用 SSH Key 或 MCP 授权链路。Nginx 配置更新需在修改前自动备份并保留最近 5 个版本。

## Goals / Non-Goals

**Goals:**
- 提供异步环境探测能力，覆盖宿主机路径可达性、读写权限、磁盘空间与 Nginx 可用性
- 提供 `GET /env/health` 端点输出可读的健康报告，包含失败原因与连接延迟
- 在 Nginx 配置变更前执行带时间戳的备份并控制保留数量
- 支持 APP_ROOT_DIR 动态注入并提供开发环境默认值

**Non-Goals:**
- 不在本阶段实现实际的 Nginx 配置写入与重载
- 不引入新的认证体系或外部依赖管理服务
- 不实现全量环境巡检与资源监控体系

## Decisions

- 采用异步探测执行路径与权限检查
  - 理由：降低宿主机负载波动对 API 响应的影响，避免阻塞请求线程
  - 备选方案：同步串行探测
  - 不选原因：在高负载或网络抖动时会显著拉长响应时间

- 以明确的故障分型输出探测结果
  - 理由：将“不可达”与“权限不足”分开，使运维/AI 能采取不同修复路径
  - 备选方案：统一错误信息
  - 不选原因：会导致错误修复路径不清晰且易误判

- Nginx 备份采用时间戳命名并限制保留最近 5 份
  - 理由：可追溯且避免无限增长占用磁盘
  - 备选方案：覆盖单一备份文件
  - 不选原因：无法回溯多版本变更风险

- APP_ROOT_DIR 在无环境变量时回退到开发默认值
  - 理由：保证开发环境可启动并减少配置缺失导致的启动失败
  - 备选方案：强制要求环境变量
  - 不选原因：增加本地开发与测试门槛

## Risks / Trade-offs

- 探测异步化增加并发复杂度 → 采用受控并发与超时限制，避免资源耗尽
- SSH 握手耗时波动导致误报警告 → 设置阈值并标记为 Warning 而非硬失败
- 备份保留策略误删需要的历史版本 → 仅清理超过 5 份的最旧备份并记录日志
